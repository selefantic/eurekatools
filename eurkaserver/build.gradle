/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.6.3/userguide/tutorial_java_projects.html
 */

plugins {
    id 'java'   
    id "io.spring.dependency-management" version "${iospringManVersion}"     
    id "org.springframework.boot" version "${springbootVersion}"
    id 'application'
}

def env = "dev"   


ext {
    //2.指定扩展参数-主类
    masterMain = 'com.euraserver.build.SpringCloudEurkaServerApplication'
    //3.指定启动类配置文件
    masterSources = files("$buildDir/resources/main")
}

dependencies {
    //implementation "com.google.guava:guava:${guavaVersion}"    
    //implementation "org.springframework.boot:spring-boot-starter-undertow:${undertowVersion}"
    //implementation 'org.springframework.boot:spring-boot-starter-web'   
    //implementation 'org.springframework.boot:spring-boot-starter-log4j2'    
    //implementation 'com.github.ben-manes.caffeine:caffeine'
    
    implementation("org.springframework.cloud:spring-cloud-starter-netflix-eureka-server:${springCloudStarterNetflixEurekaServerVersion}")
    
    implementation "org.springframework.boot:spring-boot-starter-security:${springbootSecurityVersion}"

	//testImplementation 'org.testng:testng:7.0.0-beta7'
}

tasks.startScripts {
    classpath += files("resource")
    doLast {
        //针对不同的平台进行不同的包文件格式
        def windowsScriptFile = file getWindowsScript()
        def unixScriptFile = file getUnixScript()
        windowsScriptFile.text = windowsScriptFile.text.replace('$APP_HOME/lib/resource', '$APP_HOME/resource')
        unixScriptFile.text = unixScriptFile.text.replace('$APP_HOME/lib/resource', '$APP_HOME/resource')
    }
}


configurations {
	compile.exclude module: 'spring-boot-starter-tomcat'
	compile.exclude module: 'spring-cloud-netflix-ribbon'
	compile.exclude module: 'spring-boot-starter-logging' 	
	all*.exclude group:'org.springframework.boot',module:'spring-boot-starter-tomcat'
}

jar {
    baseName = 'eruka-server'
    version = '0.0.1'  
	//exclude "classpath:application-dev.yml"
    manifest {
        attributes "Manifest-Version": 1.0,
                'Main-Class': 'com.euraserver.build.SpringCloudEurkaServerApplication'
    }
}

application {
    // Define the main class for the application
    mainClassName = masterMain
}


